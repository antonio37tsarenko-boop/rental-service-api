generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  extensions = [postgis]
  url        = env("DATABASE_URL")
}

enum UserRoles {
  USER
  ADMIN
}

enum BikeTypeNames {
  CITY
  ROAD
  MOUNTAIN
}

enum BikeStatuses {
  AVAILABLE
  RENTED
  MAINTENANCE
}

enum GeoZoneTypes {
  PARKING
  FORBIDDEN
  SPEED_LIMIT
}

model BikeType {
  id             Int           @id @default(autoincrement())
  name           BikeTypeNames
  requiresEnergy Boolean       @default(false)
  priceFactor    Float         @default(1)
  bikes          Bike[]
}

model Bike {
  id            String                                @id @default(uuid(7))
  typeId        Int
  type          BikeType                              @relation(fields: [typeId], references: [id])
  batteryCharge Int                                   @default(100)
  location      Unsupported("geometry(Point, 4326)")?
  status        BikeStatuses

  rents Rental[]
}

model User {
  id             String    @id @default(uuid(7))
  email          String    @unique
  hashedPassword String
  balance        Decimal   @default(0)
  firstName      String?
  middleName     String?
  lastName       String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  role           UserRoles @default(USER)
  rentals        Rental[]
}

model GeoZone {
  id         Int                                    @id @default(autoincrement())
  type       GeoZoneTypes
  area       Unsupported("geometry(Polygon, 4326)")
  speedLimit Decimal?
}

model Rental {
  id         String    @id @default(uuid(7))
  userId     String
  user       User      @relation(fields: [userId], references: [id])
  bikeId     String
  bike       Bike      @relation(fields: [bikeId], references: [id])
  startTime  DateTime  @default(now())
  endTime    DateTime?
  totalPrice Decimal?
}
